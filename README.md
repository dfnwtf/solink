# SOLink – Secure Wallet-to-Wallet Messenger

SOLink — современный мессенджер c акцентом на приватность. Клиент и Cloudflare Worker полностью переписаны под новый UX, трёхколоночный макет и сквозное шифрование сообщений.

## Основные возможности

- **Wallet-first UX.** Авторизация через Phantom (или совместимый Solana-кошелёк). Состояние кошелька управляет рабочим пространством и локальной БД.
- **Durable Object очередь.** Сообщения попадают в Durable Object, подтверждаются через `/messages/ack`, поэтому доставка «at least once» гарантирована.
- **End-to-end шифрование.**
  - На клиенте генерируется пара X25519 (TweetNaCl), публичный ключ публикуется в профиле.
  - При первом контакте вычисляется общий секрет (Diffie–Hellman) и кэшируется в IndexedDB.
  - `send` шифрует текст, воркер хранит только ciphertext, расшифровка происходит локально.
- **Современный фронтенд.** Dark UI, трёхколоночный макет (навигация → список чатов → диалог + инфо-панель), адаптивная верстка.
- **IndexedDB Workspaces.** Для каждого кошелька создаётся свой namespace (`solink-db-wallet-...`). При смене кошелька UI сбрасывается и подгружает соответствующие данные.
- **Cloudflare KV + Worker.** Профили, никнеймы, публичные ключи и rate limit обрабатываются в Worker.

## Стек

| Компонент | Технологии |
|-----------|------------|
| Фронтенд  | HTML/CSS/Vanilla JS, TweetNaCl, IndexedDB |
| Бэкенд    | Cloudflare Workers + KV + Durable Objects |
| Доставка  | Long-poll (`/inbox/poll?wait=15000`) + ack (`/messages/ack`) |

## Быстрый старт

1. Установи зависимости для Wrangler (локально или через `npm install wrangler`).
2. Настрой `.env`/`wrangler secret` для токенов (если требуется).
3. Локальный запуск фронта — просто открой `public/app.html`.
4. Для dev-бэкенда: `wrangler dev --local`.
5. Продакшн: `wrangler deploy`.

## Безопасность

- Приватные ключи кошелька никогда не покидают Phantom.
- Ключи шифрования хранятся локально в IndexedDB, публикация — только публичного ключа.
- Worker хранит только ciphertext + метаданные; plaintext нигде не логируется и не кэшируется.

## Структура репозитория

```
public/        # фронтенд
worker/        # Cloudflare Worker + Durable Object
docs/          # дизайн-концепт и заметки
wrangler.toml  # конфиг развертывания
```

## Roadmap

- [x] Новый UI/UX
- [x] Durable Object очередь + ack
- [x] Глобальные @nicknames
- [x] End-to-end шифрование
- [ ] Дизайн-полировка и onboarding-анимация
- [ ] Нативные push-уведомления

---

Если хочется повторить локально: подтяни репозиторий, запусти `wrangler dev` и открой `public/app.html?v=dev`. Все ключи/секреты задаются через Phantom/IndexedDB, поэтому репозиторий безопасен для публичного размещения.

